# Copy this file to terraform.tfvars and fill in the values
# terraform.tfvars is gitignored and should not be committed

app_name    = "kratos"
environment = "<dev | prod | qa | test | any>"
aws_region  = "<region>"

# VPC Configuration
vpc_id     = "vpc-xxxxxxxxx"
vpc_cidr   = "10.0.0.0/16"

# Subnet Configuration (public subnets for ALB and ECS - cheapest, security via SGs)
public_subnet_ids = ["subnet-xxxxxxxxx", "subnet-yyyyyyyyy"]

# Route53 Configuration
hosted_zone_id = "Z1234567890ABC"
kratos_domain  = "identity.<hostedzone>" # e.g. identity.example.com

acm_subject_alternative_names = ["<subdomain>.oauthentra.com", "*.oauthentra.com"]

# Kratos Configuration
kratos_image     = "oryd/kratos"
kratos_image_tag = "v25.4.0-distroless"


# Cost-optimized settings for dev (Kratos)
kratos_cpu         = 256
kratos_memory      = 512
kratos_desired_count = 1
log_retention_days = 7

kratos_public_port = 4433
kratos_admin_port = 4434

# Security Groups allowed to access admin endpoint (optional)
allowed_security_group_ids = []

# ------------------------------------------------------------------------------
# Kratos environment variables (non-secret)
# Static kratos-config.yaml cannot use ${VAR}; these override/supply config.
# Naming: nested YAML keys → UPPER_SNAKE_CASE (e.g. courier.smtp.connection_uri → COURIER_SMTP_CONNECTION_URI).
# Arrays: SERVE_PUBLIC_CORS_ALLOWED_ORIGINS_0, _1, ...
# ------------------------------------------------------------------------------
kratos_environment_vars = [
  # Courier (email) - from_address is non-secret; connection_uri goes in kratos_secrets
  {
    name  = "COURIER_SMTP_FROM_ADDRESS"
    value = "noreply@<domain>.com"
  },
  # CORS allowed origins (add _1, _2 for more)
  {
    name  = "SERVE_PUBLIC_CORS_ALLOWED_ORIGINS_0"
    value = "https://app.<domain>.com"
  },
  # Allowed return URLs
  {
    name  = "SELFSERVICE_ALLOWED_RETURN_URLS_0"
    value = "https://identity.<domain>.com/"
  },
  # WebAuthn RP origins (must match rp.id / HTTPS origins)
  {
    name  = "SELFSERVICE_METHODS_WEBAUTHN_CONFIG_RP_ORIGINS_0"
    value = "https://identity.<domain>.com"
  }
]

# ------------------------------------------------------------------------------
# Kratos Secrets Manager IAM - ARN patterns the task execution role can read
# Use * to match secret name suffix (e.g. dev/kratos* matches dev/kratos-ppnJ7z)
# ------------------------------------------------------------------------------
kratos_secrets_manager_secret_arns = [
  "arn:aws:secretsmanager:us-east-1:208527038873:secret:dev/kratos*"
]

# ------------------------------------------------------------------------------
# Kratos secrets (from AWS Secrets Manager - use valueFrom ARN)
# Store sensitive values in Secrets Manager; reference by secret ARN + optional JSON key.
# For key-value secret: use arn:aws:secretsmanager:REGION:ACCOUNT:secret:NAME:key::
# ------------------------------------------------------------------------------
# Example: single key-value secret (dev/kratos) - use :KEY_NAME:: for each key
# Replace -xxxxxx with your secret's AWS-generated suffix
kratos_secrets = [
  {
    name      = "DSN"
    valueFrom = "arn:aws:secretsmanager:us-east-1:1234567890:secret:dev/kratos-xxxxxx:DSN::"
  },
  {
    name      = "SECRETS_COOKIE"
    valueFrom = "arn:aws:secretsmanager:us-east-1:1234567890:secret:dev/kratos-xxxxxx:SECRETS_COOKIE::"
  },
  {
    name      = "SECRETS_CIPHER"
    valueFrom = "arn:aws:secretsmanager:us-east-1:1234567890:secret:dev/kratos-xxxxxx:SECRETS_CIPHER::"
  },
  {
    name      = "COURIER_SMTP_CONNECTION_URI"
    valueFrom = "arn:aws:secretsmanager:us-east-1:1234567890:secret:dev/kratos-xxxxxx:COURIER_SMTP_CONNECTION_URI::"
  }
]

# ------------------------------------------------------------------------------
# Hydra (OAuth2/OIDC) - auth.oauthentra.com
# ------------------------------------------------------------------------------
hydra_image     = "oryd/hydra"
hydra_image_tag = "v25.4.0-distroless"

hydra_domain = "<subdomain>.oauthentra.com"

# Hydra secrets (DSN required - use same or separate DB)
hydra_secrets_manager_secret_arns = ["arn:aws:secretsmanager:us-east-1:1234567890:secret:dev/hydra*"]
hydra_secrets = [
  { name = "DSN", valueFrom = "arn:aws:secretsmanager:us-east-1:1234567890:secret:dev/hydra-xxxxxx:DSN::" }
]

hydra_cpu          = 256
hydra_memory       = 512
hydra_desired_count = 1

hydra_public_port = 4444
hydra_admin_port = 4445

hydra_environment_vars = []

hydra_s3_config_key = "hydra-config.yaml"